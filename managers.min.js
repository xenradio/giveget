function setCompanyIdentifier(){let e=0;!function t(){let n=document.getElementById("company-name").value;n?(localStorage.setItem("company_identifier",n),console.log("Company identifier saved:",n)):e<5?(e++,setTimeout(t,1e3),console.log("Retrying to find company identifier...")):console.log("Failed to find company identifier after several attempts.")}()}function loadCompanyName(){var e=0,t=setInterval(function(){var n=localStorage.getItem("company_identifier");null!==n?(document.getElementById("companyName").textContent=n,clearInterval(t)):e>=10&&(console.log("Failed to load company identifier from local storage after 10 retries."),clearInterval(t)),e++},1e3)}function fetchAndDisplayImage(e=localStorage.getItem("company_identifier")){fetch(`https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/managers?company_identifier=${e}`).then(e=>e.json()).then(t=>{let n=t.find(t=>t.company_identifier===e);n&&n.company_logo&&n.company_logo.url&&document.querySelectorAll('[xn-data="company-logo"]').forEach(e=>{e.src=n.company_logo.url})}).catch(e=>{console.error("Error fetching image:",e)})}setCompanyIdentifier(),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("donationTotal"),t=document.getElementById("donationTable"),n=document.getElementById("donationCalc"),a=document.getElementById("donationCheck"),o=document.getElementById("updateButton");function r(t,a=5,o=1e3){let l=localStorage.getItem("company_identifier");if(l){let d=encodeURIComponent(l),c=`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/members?company_identifier=${d}`,s=`https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/managers?company_identifier=${d}`;Promise.all([fetch(c),fetch(s)]).then(e=>Promise.all(e.map(e=>e.json()))).then(([a,o])=>(function t(a,o,r){let l=new Set;o.forEach(e=>{"paid"===e.payment_status&&e.donations.forEach(e=>{let t=e.donation_ids.split(",").map(e=>e.trim());t.forEach(e=>l.add(e))})});let d={},c=0;a.forEach(e=>{(e.donated_to||[]).flat().forEach(t=>{t&&t.name&&t.amount&&!l.has(t.donation_id)&&(d[t.name]||(d[t.name]={donations:[],totalDonation:0}),d[t.name].donations.push({email:e.email,amount:t.amount,donation_id:t.donation_id}),d[t.name].totalDonation+=t.amount,c+=t.amount)})}),r===e&&(r.textContent=`A$${c}`),r===n&&function e(t){let n=document.querySelector(".donation_info");n.innerHTML="",Object.entries(t).forEach(([e,t])=>{let a=document.createElement("div");a.classList.add("donation_row");let o=t.donations.map(e=>`${e.email} - A$${e.amount} <span class="donation_id">${e.donation_id}</span>`).join("<br>");a.innerHTML=`
        <input type="checkbox" class="donation_checkbox" data-amount="${t.totalDonation}">
        <div class="donation_char">${e}</div>
        <div class="donation_user">${o}</div>
        <div class="char_donation-amount">
          <div class="char_donation-number">A$${t.totalDonation}</div>
          <div class="char_donation-text">Total amount donated</div>
        </div>`,n.appendChild(a),a.addEventListener("click",e=>{if(!e.target.classList.contains("donation_checkbox")){let t=a.querySelector(".donation_checkbox");t.checked=!t.checked,t.dispatchEvent(new Event("change"))}})});let a=n.querySelectorAll(".donation_checkbox");a.forEach(e=>{e.addEventListener("change",i),e.addEventListener("change",function(){let e=document.querySelector(".modal_error");document.querySelectorAll(".donation_checkbox:checked").length>0&&(e.style.display="none")})})}(d)})(a,o,t)).catch(e=>console.error("Error fetching data: ",e))}else a>0?setTimeout(()=>r(t,a-1,o),o):console.error("Failed to retrieve company_identifier from local storage after multiple retries.")}function i(){let e=document.querySelector(".donation_info"),t=e.querySelectorAll(".donation_checkbox"),o=0;t.forEach(e=>{e.checked&&(o+=parseFloat(e.dataset.amount))}),n.textContent=`A$${o}`,Array.from(t).every(e=>e.checked);let r=Array.from(t).some(e=>e.checked);a.textContent=r?"Uncheck all":"Check all"}n.textContent="A$0",r(e),t.addEventListener("click",function(){r(n)}),a.addEventListener("click",function e(){let t=document.querySelector(".donation_info"),n=t.querySelectorAll(".donation_checkbox"),a=Array.from(n).some(e=>e.checked);n.forEach(e=>{e.checked=!a,e.dispatchEvent(new Event("change"))}),i()}),o.addEventListener("click",function(){r(e),r(n)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("updateButton");async function t(e=5,n=1e3){let a=localStorage.getItem("company_identifier");if(a){let o=encodeURIComponent(a),r=`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/members?company_identifier=${o}`,i=`https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/managers?company_identifier=${o}`;try{let[l,d]=await Promise.all([fetch(r),fetch(i)]),c=await l.json(),s=await d.json(),m=new Set;s.forEach(e=>{"paid"===e.payment_status&&e.donations.forEach(e=>{let t=e.donation_ids.split(",").map(e=>e.trim());t.forEach(e=>m.add(e))})}),function e(t,n){let a={};t.forEach(e=>{(e.donated_to||[]).flat().forEach(t=>{t&&t.name&&t.amount&&(a[t.name]||(a[t.name]={link:t.link||"#",logo:t.logo_url||"https://assets-global.website-files.com/65debf94c45187dc7c67abf2/6630bf08dad504d24be09767_charity_default.svg",donations:[],totalDonation:0}),a[t.name].donations.push({name:e.name,email:e.email,amount:t.amount,donation_id:t.donation_id}))})}),function e(t,n){let a=document.getElementById("charTable");a.innerHTML="",Object.entries(t).forEach(([e,t])=>{let o=t.donations.filter(e=>!n.has(e.donation_id)),r=o.reduce((e,t)=>e+t.amount,0);if(o.length>0){let i=document.createElement("div");i.classList.add("char_table-wrapper"),i.innerHTML=`
          <div class="char_name-wrapper">
            <img loading="lazy" src="${t.logo}" alt="" class="char_image">
            <a href="${t.link}" class="char_link w-inline-block" target="_blank">
              <div>${e}</div>
              <div class="char_link-icon w-embed">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6"></path>
                  <path d="M11 13l9 -9"></path>
                  <path d="M15 4h5v5"></path>
                </svg>
              </div>
            </a>
          </div>
          <table class="char-table_component">
            <thead class="char-table_head">
              <tr class="char-table_row is-ua">
                <th class="char-table_header">Team member name</th>
                <th class="char-table_header">Team member email</th>
                <th class="char-table_header">Amount donated</th>
              </tr>
            </thead>
            <tbody class="char-table_body">
              ${o.map(e=>`<tr class="char-table_row is-ua">
                  <td class="char-table_cell">${e.name} <span class="donation_id">${e.donation_id}</span></td>
                  <td class="char-table_cell"><a href="mailto:${e.email}">${e.email}</a></td>
                  <td class="char-table_cell">A$${e.amount}</td>
                </tr>`).join("")}
            </tbody>
          </table>
          <div class="char_donation-wrapper">
            <div class="char_donation-amount">
              <div class="char_donation-number">A$${r}</div>
              <div>Total amount donated</div>
            </div>
            <a href="#" class="button is-managers w-button" style="display: none;">Donate</a>
          </div>`,a.appendChild(i)}})}(a,n)}(c,m)}catch(u){console.error("Error fetching data: ",u)}}else e>0?setTimeout(()=>t(e-1,n),n):console.error("Failed to retrieve company_identifier from local storage after multiple retries.")}t(),e.addEventListener("click",function(){t()})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("updateButton");async function t(e=5,t=1e3){let n=localStorage.getItem("company_identifier"),a=0;for(;!n&&a<e;)await new Promise(e=>setTimeout(e,t)),n=localStorage.getItem("company_identifier"),a++;if(n){let o=encodeURIComponent(n),r=`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/members?company_identifier=${o}`,i=`https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/managers?company_identifier=${o}`;try{let[l,d]=await Promise.all([fetch(r),fetch(i),]),c=await l.json(),s=await d.json();(function e(t,n){let a=new Set,o={};n.forEach(e=>{"paid"===e.payment_status&&e.donations.forEach(e=>{let t=e.donation_ids.split(",").map(e=>e.trim());t.forEach(t=>{a.add(t),o[t]=e.payment_date})})});let r={};t.forEach(e=>{(e.donated_to||[]).flat().forEach(t=>{a.has(t.donation_id)&&(r[t.name]||(r[t.name]={donations:[],totalDonation:0,logo:t.logo_url||"https://assets-global.website-files.com/65debf94c45187dc7c67abf2/6630bf08dad504d24be09767_charity_default.svg"}),r[t.name].donations.push({name:e.name,email:e.email,amount:t.amount,donation_id:t.donation_id,payment_date:o[t.donation_id]||""}),r[t.name].totalDonation+=t.amount)})}),function e(t){let n=document.getElementById("donatedTable");n.innerHTML="",Object.entries(t).forEach(([e,t])=>{let a=document.createElement("div");a.classList.add("char_table-wrapper"),a.innerHTML=`
        <div class="char_name-wrapper">
          <img loading="lazy" src="${t.logo}" alt="" class="char_image">
          <a href="#" class="char_link w-inline-block" target="_blank">
            <div>${e}</div>
            <div class="char_link-icon w-embed">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6"></path>
                <path d="M11 13l9 -9"></path>
                <path d="M15 4h5v5"></path>
              </svg>
            </div>
          </a>
        </div>
        <table class="char-table_component">
          <thead class="char-table_head">
            <tr class="char-table_row is-ua">
              <th class="char-table_header">Team member name</th>
              <th class="char-table_header">Team member email</th>
              <th class="char-table_header">Amount donated</th>
            </tr>
          </thead>
          <tbody class="char-table_body">
            ${t.donations.map(e=>`<tr class="char-table_row is-ua">
                <td class="char-table_cell">${e.name} <span class="donation_id">${e.donation_id}</span></td>
                <td class="char-table_cell"><a href="mailto:${e.email}">${e.email}</a></td>
                <td class="char-table_cell">A$${e.amount}</td>
              </tr>`).join("")}
          </tbody>
        </table>
        <div class="char_donation-wrapper">
          <div class="donation_details">
            <img loading="lazy" src="https://cdn.prod.website-files.com/65debf94c45187dc7c67abf2/664366ba679054e9dafb8127_heart.svg" alt="" class="donated_icon">
            <div>Donated<br>at <span id="donationDate">${t.donations[0]?.payment_date||""}</span></div>
          </div>
          <div class="char_donation-amount">
            <div class="char_donation-number">A$${t.totalDonation}</div>
            <div>Total amount donated</div>
          </div>
        </div>`,n.appendChild(a)}),Object.keys(t).length>0?document.getElementById("donationHistory").style.display="flex":document.getElementById("donationHistory").style.display="none"}(r)})(c,s)}catch(m){console.error("Error fetching data: ",m)}}else console.error("Failed to retrieve company_identifier from local storage after multiple retries.")}t(),e.addEventListener("click",function(){t()})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("donateButton"),t=document.querySelector(".modal_error");e.addEventListener("click",function(e){e.preventDefault();let n=document.getElementById("donationCalc").textContent,a=100*parseInt(n.replace("A$","")),o=document.querySelectorAll(".donation_checkbox:checked");if(0===o.length){t.style.display="block";return}let r="Donation from: ",i={},l=0,d=[],c=localStorage.getItem("company_identifier"),s=document.getElementById("wf-user-account-email");if(!s){console.error("Error: Email field not found");return}let m=s.value.trim();if(!m){console.error("Error: Email is empty");return}r+=`${c} (${m})`,o.forEach(e=>{let t=e.closest(".donation_row"),n=t.querySelector(".donation_char").textContent.trim(),a=t.querySelector(".char_donation-number").textContent.trim(),o=parseFloat(a.replace("A$","")),r=t.querySelectorAll(".donation_id");i[n]=a,l+=o,r.forEach(e=>{let t=e.textContent.trim();d.push(t)})});let u=new Date().toISOString().split("T")[0],p=Date.now().toString();i.payment_date=u,i.payment_id=p,i.total_amount=`A$${l.toFixed(2)}`,i.user_email=m,i.company_identifier=c,i.donation_ids=d.join(",");let h={success_url:"https://haveyoursay.givenget.org/success",cancel_url:"https://haveyoursay.givenget.org/fail",line_items:[{price_data:{currency:"aud",product:"prod_QcLX67ceT7Mxuq",unit_amount:a},quantity:1,description:r.trim()},],metadata:{"Donation details":`https://haveyoursay.givenget.org/donation-details?payment_id=${p}`},donation_details:i,email:m,payment_id:p};fetch("https://xqsu-ttbr-nccs.n7c.xano.io/api:UQuTJ3vx/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(e=>e.json()).then(e=>{if(e.result&&e.result.url){let t=e.result.payment_intent;fetch(`https://xqsu-ttbr-nccs.n7c.xano.io/api:UQuTJ3vx/payment_Intent?payment_intent=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(()=>{window.location.href=e.result.url}).catch(e=>{console.error("Error retrieving payment intent details:",e)})}else console.error("Failed to create Stripe session:",e)}).catch(e=>{console.error("Error:",e)})}),document.querySelectorAll(".donation_checkbox").forEach(e=>{e.addEventListener("change",function(){document.querySelectorAll(".donation_checkbox:checked").length>0&&(t.style.display="none")})})}),document.addEventListener("DOMContentLoaded",function(){!function e(t=0){var n=localStorage.getItem("company_identifier");if(n){var a="https://haveyoursay.givenget.org/team-signup?company="+encodeURIComponent(n),o=document.getElementById("surveyLink");o&&(o.textContent=a)}else t<10?setTimeout(function(){e(t+1)},1500):console.error("Failed to load company identifier from local storage.")}()}),loadCompanyName(),document.getElementById("uploadLogoBtn").addEventListener("click",function(){let e=document.createElement("input");e.type="file",e.accept="image/png, image/jpeg",e.onchange=e=>{let t=e.target.files[0];if(!t||t.size>102400||"image/png"!==t.type&&"image/jpeg"!==t.type){alert("File must be PNG or JPEG and no more than 100KB.");return}let n=new FormData;n.append("logo",t),n.append("company_identifier",localStorage.getItem("company_identifier")),fetch("https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/managers_logo",{method:"POST",body:n}).then(e=>e.json()).then(e=>{console.log("Upload successful",e),fetchAndDisplayImage()}).catch(e=>{console.error("Error uploading image:",e)})},e.click()}),document.addEventListener("DOMContentLoaded",function(){setTimeout(fetchAndDisplayImage,1e3)}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("updateButton");function t(e=5,a=1e3){let o=localStorage.getItem("company_identifier");if(o){let r=encodeURIComponent(o),i=`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/members?company_identifier=${r}`;fetch(i).then(e=>e.json()).then(n).catch(e=>console.error("Error fetching data: ",e))}else e>0?setTimeout(()=>t(e-1,a),a):console.error("Failed to retrieve company_identifier from local storage after multiple retries.")}function n(e){let t=e.sort((e,t)=>t.completed-e.completed),n=document.querySelector(".tm-table_body");n.innerHTML="",t.forEach(e=>{let t=document.createElement("tr");t.classList.add("tm-table_row");let a=new Date(e.created_at),o=a.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),r=Array.isArray(e.donated_to)?e.donated_to:[],i=Array.isArray(e.yes_responses)?e.yes_responses:[],l=r.filter(e=>Array.isArray(e)&&e.length>0).map(e=>e.map(e=>`${e.name} - A$${e.amount}`).join("<br>")).join("<br>"),d=i.filter(e=>"Activities"===e.category).map(e=>e.subcategory).join(", "),c=i.filter(e=>"Donation method"===e.category).map(e=>e.subcategory).join(", "),s=i.filter(e=>"Activities"!==e.category&&"Donation method"!==e.category).map(e=>e.subcategory).join(", ");t.innerHTML=`
              <td class="tm-table_cell member-name">${e.name},<br><a href="mailto:${e.email}">${e.email}</a></td>
              <td class="tm-table_cell member-status ${e.completed?"status-completed":"status-not-completed"}">
                ${e.completed?'<div class="complete_tag">Completed</div>':'<div class="notcomplete_tag">Not completed</div>'}
              </td>
              <td class="tm-table_cell member-date">${o||"N/A"}</td>
              <td class="tm-table_cell member-causes">${s}</td>
              <td class="tm-table_cell member-donation-methods">${c}</td>
              <td class="tm-table_cell member-activities">${d}</td>
              <td class="tm-table_cell member-donated-to">${l}</td>
              <td class="tm-table_cell member-amount-donated">A$${e.donation_amount||0}</td>
          `,n.appendChild(t)})}t(),e.addEventListener("click",function(){t()})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("sort");e.addEventListener("change",function(){let e=this.value;(function e(t){let n,a,o,r,i,l,d=document.querySelector(".tm-table_component");for(a=!0;a;)for(o=1,a=!1,n=d.rows;o<n.length-1;o++){switch(l=!1,t){case"Name":(r=n[o].querySelector(".member-name").textContent.toLowerCase())>(i=n[o+1].querySelector(".member-name").textContent.toLowerCase())&&(l=!0);break;case"Amount":(r=parseInt(n[o].querySelector(".member-amount-donated").textContent.replace(/[^0-9]/g,"")))<(i=parseInt(n[o+1].querySelector(".member-amount-donated").textContent.replace(/[^0-9]/g,"")))&&(l=!0);break;case"Completed":r=n[o].querySelector(".member-status").textContent.includes("Completed"),i=n[o+1].querySelector(".member-status").textContent.includes("Completed"),!r&&i&&(l=!0)}if(l){n[o].parentNode.insertBefore(n[o+1],n[o]),a=!0;break}}})(e)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("updateButton");function t(e=5,n=1e3){let a=localStorage.getItem("company_identifier");if(a){let o=`https://xqsu-ttbr-nccs.n7c.xano.io/api:6QL-WByo/metrics?company_identifier=${encodeURIComponent(a)}`;fetch(o).then(e=>e.json()).then(e=>{document.getElementById("totalMembers").textContent=e.sessions_count,document.getElementById("totalSessions").textContent=e.sessions_completed;let t=e.sessions_completed/e.sessions_count*100,n=document.getElementById("averageTime");n?n.textContent=e.sessions_average.averageSessionDuration.toFixed(1):console.error("Average time element not found");let a=document.getElementById("totalAmount");a?a.textContent=`A$${e.donation_amount.toFixed(2)}`:console.error("Total amount element not found"),drawEngagementChart(t,100-t)}).catch(e=>{console.error("Error fetching data:",e)})}else e>0?setTimeout(()=>t(e-1,n),n):console.error("Failed to retrieve company_identifier from local storage after multiple retries.")}t(),e.addEventListener("click",function(){t()})}),document.addEventListener("DOMContentLoaded",function(){let e=()=>{let t=localStorage.getItem("company_identifier");if(!t){console.error("Company identifier not found in local storage, retrying..."),setTimeout(e,1e3);return}let n=`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/popular_responses?company_identifier=${encodeURIComponent(t)}`;fetch(n).then(e=>e.json()).then(e=>{updateCausesChart(e),updateActivitiesChart(e),updateDonationChart(e)}).catch(e=>console.error("Error fetching data:",e))};setTimeout(e,1e3);let t=document.getElementById("updateButton");t.addEventListener("click",e)});var engagementChartInstance=null;function drawEngagementChart(e,t){var n=document.getElementById("engagementChart").getContext("2d");return engagementChartInstance&&engagementChartInstance.destroy(),engagementChartInstance=new Chart(n,{type:"pie",data:{labels:["Participated","Not Participated"],datasets:[{data:[e,t],backgroundColor:["rgba(46, 204, 113, 1)","rgba(232, 76, 61, 1)"],borderWidth:0},]},options:{responsive:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255, 255, 255, 0.8)"}},tooltip:{enabled:!0,callbacks:{label:function(e){var t=e.label||"";return t&&(t+=": "),null!==e.parsed&&(t+=Math.round(100*e.parsed)/100+"%"),t}}}}}})}var causesChartInstance=null;function updateCausesChart(e){var t=e.popular_causes.topSubcategories,n=t.map(function(e){return e.subcategory}),a=t.reduce(function(e,t){return e+t.count},0),o=t.map(function(e){return e.count/a*100}),r=document.getElementById("causesChart").getContext("2d");causesChartInstance&&causesChartInstance.destroy(),causesChartInstance=new Chart(r,{type:"bar",data:{labels:n,datasets:[{label:"Percentage",data:o,backgroundColor:"rgba(243, 115, 36, 0.6)",borderColor:"rgba(243, 115, 36, 1)",borderWidth:1,borderRadius:{topLeft:4,topRight:4,bottomLeft:0,bottomRight:0},barThickness:16,barPercentage:.8,categoryPercentage:.8}]},options:{scales:{x:{ticks:{color:"rgba(255, 255, 255, 0.8)"},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"rgba(255, 255, 255, 0.8)",callback:function(e){return Math.round(e)+"%"}},grid:{color:"rgba(255, 255, 255, 0.2)"}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.dataset.label+": "+Math.round(e.raw)+"%"}}}},responsive:!0}})}var activitiesChartInstance=null;function updateActivitiesChart(e){var t=e.popular_activities.popularActivities,n=t.map(function(e){return e.subcategory}),a=t.reduce(function(e,t){return e+t.count},0),o=t.map(function(e){return e.count/a*100}),r=document.getElementById("activitiesChart").getContext("2d");activitiesChartInstance&&activitiesChartInstance.destroy(),activitiesChartInstance=new Chart(r,{type:"bar",data:{labels:n,datasets:[{label:"Engagement",data:o,backgroundColor:"rgba(243, 115, 36, 0.6)",borderColor:"rgba(243, 115, 36, 1)",borderWidth:1,borderRadius:{topLeft:4,topRight:4,bottomLeft:0,bottomRight:0},barThickness:16,barPercentage:.8,categoryPercentage:.8}]},options:{scales:{x:{ticks:{color:"rgba(255, 255, 255, 0.8)"},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"rgba(255, 255, 255, 0.8)",callback:function(e){return Math.round(e)+"%"}},grid:{color:"rgba(255, 255, 255, 0.2)"}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return e.dataset.label+": "+e.raw.toFixed(2)+"%"}}}},responsive:!0}})}var donationChartInstance=null;function updateDonationChart(e){var t=e.popular_donation_methods.popularActivities,n=t.map(function(e){return e.subcategory}),a=t.reduce(function(e,t){return e+t.count},0),o=t.map(function(e){return e.count/a*100}),r=document.getElementById("donationChart").getContext("2d");donationChartInstance&&donationChartInstance.destroy(),donationChartInstance=new Chart(r,{type:"pie",data:{labels:n,datasets:[{data:o,backgroundColor:["rgba(46, 204, 113, 1)","rgba(232, 76, 61, 1)","rgba(155, 89, 182, 1)","rgba(52, 152, 219, 1)","rgba(241, 196, 15, 1)"],borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255, 255, 255, 0.8)"}},tooltip:{enabled:!0,callbacks:{label:function(e){var t=e.label||"";return t&&(t+=": "),t+=e.raw.toFixed(2)+"%"}}}}}})}var donatedChartInstance=null;function fetchMemberData(e=5,t=2e3){let n=localStorage.getItem("company_identifier");if(!n&&e>0){console.warn(`Company identifier not found in localStorage. Retrying in ${t}ms. Retries left: ${e}`),setTimeout(()=>fetchMemberData(e-1,t),t);return}if(!n){console.error("No company identifier found in localStorage after retries."),alert("Failed to load company identifier. Please refresh the page or check back later.");return}let a=encodeURIComponent(n);fetch(`https://xqsu-ttbr-nccs.n7c.xano.io/api:wXyyqNPC/members?company_identifier=${a}`).then(e=>e.json()).then(e=>{let t=0,n=0;e.forEach(e=>{e.completed&&(e.donation_amount>0?t++:n++)}),console.log("Drawing chart with data:",t,n),drawDonationChart(t,n)}).catch(e=>{console.error("Error fetching data:",e),alert("Failed to fetch data. Check the console for more details.")})}function drawDonationChart(e,t){var n=document.getElementById("donatedChart").getContext("2d");donatedChartInstance&&donatedChartInstance.destroy(),donatedChartInstance=new Chart(n,{type:"pie",data:{labels:["Donated","Not Donated"],datasets:[{data:[e,t],backgroundColor:["rgba(46, 204, 113, 1)","rgba(232, 76, 61, 1)"],borderWidth:0},]},options:{responsive:!0,plugins:{legend:{position:"bottom",labels:{color:"rgba(255, 255, 255, 0.8)"}},tooltip:{enabled:!0,callbacks:{label:function(e){var t=e.label||"";return t&&(t+=": "),null!==e.parsed&&(t+=Math.round(100*e.parsed)/100+"%"),t}}}}}})}document.addEventListener("DOMContentLoaded",function(){console.log("DOM fully loaded and parsed"),fetchMemberData();let e=document.getElementById("updateButton");e.addEventListener("click",function(){fetchMemberData()})}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("show"),t=document.querySelector(".tm-table_component");function n(){var n=e.value,a=document.getElementById("teamTable"),o=document.getElementById("charTable"),r=document.getElementById("sortTable");"Team members"===n?(a.style.display="block",r.style.display="flex",o.style.display="none",t.style.opacity=1):"Charities"===n&&(a.style.display="none",r.style.display="none",o.style.display="block",t.style.opacity=0)}e.addEventListener("change",n),e.value="Charities",n()});const logoutButton=document.querySelector(".logout_button");logoutButton.addEventListener("click",function(){localStorage.clear()}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){let e=document.getElementById("confirmBtn"),t=document.querySelector('span[xn-data="amount"]'),n=document.querySelector('span[xn-data="expire"]'),a;function o(e=0){let r=localStorage.getItem("company_identifier");if(!r){e<5?(console.log("Retrying to fetch company identifier..."),setTimeout(()=>o(e+1),1e3)):console.error("Company identifier not available in local storage after several retries.");return}fetch(`https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/amount_time?company_identifier=${encodeURIComponent(r)}`,{headers:{"Cache-Control":"no-cache"}}).then(e=>e.json()).then(e=>{e.length>0&&void 0!==e[0].amount?(t.textContent=`A$${e[0].amount}`,e[0].deadline?function e(t){clearInterval(a);let o=new Date(t+"T00:00:00Z");console.log("Parsed Deadline Date:",o.toISOString());let r=()=>{let e=new Date,t=o.getTime()-e.getTime();t>0?n.textContent=`${Math.floor(t/864e5)}d : ${Math.floor(t%864e5/36e5)}h : ${Math.floor(t%36e5/6e4)}m`:(n.textContent="Expired",clearInterval(a))};a=setInterval(r,6e4),r()}(e[0].deadline):n.textContent="No deadline set"):(t.textContent="A$0",n.textContent="0:0:0")}).catch(e=>{console.error("Fetch error:",e)})}e.addEventListener("click",function(e){e.preventDefault(),function e(){let t=document.getElementById("teamAmount").value,n=document.getElementById("teamDate").value?function e(t){let n=t.split("-");return 3===n.length?`${n[2]}-${n[0]}-${n[1]}`:null}(document.getElementById("teamDate").value):null;if(!n){alert("Invalid date format. Please use MM-DD-YYYY.");return}let a={company_identifier:localStorage.getItem("company_identifier"),amount:t,deadline:n};console.log("Data being sent for update:",a),fetch("https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/edit_manager",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{console.log("Response after POST:",e),o()}).catch(e=>{console.error("Error submitting form:",e)})}()}),o()},1e3)}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("confirmBtn"),t=!1;e.addEventListener("click",function(n){var a,o,r,i,l,d,c,s,m;if(n.preventDefault(),t){console.log("Submission in progress, skipping this click.");return}t=!0,console.log("Confirm button clicked"),console.log("sendFormData called"),a=document.getElementById("teamAmount").value,o=document.getElementById("teamDate").value?function e(t){let n=t.split("-");return 3===n.length?`${n[2]}-${n[0]}-${n[1]}`:t}(document.getElementById("teamDate").value):null,i=(r=document.getElementById("company-name"))?r.value:"Default Company",l=document.getElementById("wf-user-account-name"),d=document.getElementById("wf-user-account-email"),console.log("Name element:",l),console.log("Email element:",d),c=l?l.value:null,s=d?d.value:null,console.log("Name value:",c),console.log("Email value:",s),m={company_identifier:i,name:c,email:s},a&&(m.amount=a),o&&(m.deadline=o),console.log("Form data to be sent:",m),e.disabled=!0,console.log("Button disabled"),fetch("https://xqsu-ttbr-nccs.n7c.xano.io/api:uoqATYAX/create_manager",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(e=>(console.log("Response received:",e),e.json())).then(n=>{console.log("Data received:",n),e.textContent="Wallets updated",setTimeout(()=>{e.textContent="Confirm",e.disabled=!1,console.log("Button re-enabled"),t=!1},2e3),document.getElementById("teamAmount").value="",document.getElementById("teamDate").value=""}).catch(n=>{console.error("Error occurred:",n),e.textContent="Failed to Send",setTimeout(()=>{e.textContent="Confirm",e.disabled=!1,console.log("Button re-enabled after error"),t=!1},2e3)})})});
